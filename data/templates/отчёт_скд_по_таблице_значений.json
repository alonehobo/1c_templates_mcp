{
  "id": "отчёт_скд_по_таблице_значений",
  "name": "Отчёт СКД по таблице значений",
  "description": "Шаблон программного отчёта на СКД с источником данных «Таблица значений»",
  "tags": [
    "СКД",
    "отчёт",
    "таблица значений",
    "схема"
  ],
  "code": "// Шаблон программного отчёта на СКД\n// Источник данных — таблица значений, формируемая кодом\n\n// ---------------------------------------------------------------------------\n// Модуль объекта (или общего модуля)\n// ---------------------------------------------------------------------------\n\n// Процедура вызывается при формировании отчёта\nПроцедура ПриКомпоновкеРезультата(ДокументРезультат, ДанныеРасшифровки, СтандартнаяОбработка) Экспорт\n\n    СтандартнаяОбработка = Ложь;\n\n    НастройкиКомпоновки = КомпоновщикНастроек.ПолучитьНастройки();\n    ДанныеРасшифровки = Новый ДанныеРасшифровкиКомпоновкиДанных;\n\n    КомпоновщикМакета = Новый КомпоновщикМакетаКомпоновкиДанных;\n    МакетКомпоновки = КомпоновщикМакета.Выполнить(\n        СхемаКомпоновкиДанных, НастройкиКомпоновки, ДанныеРасшифровки);\n\n    // Получаем данные для отчёта\n    ТаблицаДанных = ПолучитьДанныеОтчёта(НастройкиКомпоновки.ПараметрыДанных);\n\n    ВнешниеНаборыДанных = Новый Структура;\n    ВнешниеНаборыДанных.Вставить(\"ОсновнойНаборДанных\", ТаблицаДанных);\n\n    ПроцессорКомпоновки = Новый ПроцессорКомпоновкиДанных;\n    ПроцессорКомпоновки.Инициализировать(\n        МакетКомпоновки, ВнешниеНаборыДанных, ДанныеРасшифровки);\n\n    ПроцессорВывода = Новый ПроцессорВыводаРезультатаКомпоновкиДанныхВТабличныйДокумент;\n    ПроцессорВывода.УстановитьДокумент(ДокументРезультат);\n    ПроцессорВывода.Вывести(ПроцессорКомпоновки);\n\nКонецПроцедуры\n\n// ---------------------------------------------------------------------------\n// Получение данных\n// ---------------------------------------------------------------------------\n\nФункция ПолучитьДанныеОтчёта(ПараметрыДанных)\n\n    // Читаем значения параметров из настроек СКД\n    ДатаНач = ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных(\"ДатаНач\")).Значение;\n    ДатаКон = КонецДня(\n        ПараметрыДанных.НайтиЗначениеПараметра(Новый ПараметрКомпоновкиДанных(\"ДатаКон\")).Значение);\n\n    // Описываем структуру таблицы значений\n    Колонки = Новый Массив;\n    Колонки.Добавить(Новый ОписаниеТипов(\"Дата\", , , , Новый КвалификаторыДаты(ЧастиДаты.ДатаВремя)));\n    Колонки.Добавить(Новый ОписаниеТипов(\"СправочникСсылка.Контрагенты\"));\n    Колонки.Добавить(Новый ОписаниеТипов(\"Число\", , Новый КвалификаторыЧисла(15, 2)));\n\n    ТаблицаДанных = Новый ТаблицаЗначений;\n    ТаблицаДанных.Колонки.Добавить(\"Дата\",         Колонки[0]);\n    ТаблицаДанных.Колонки.Добавить(\"Контрагент\",   Колонки[1]);\n    ТаблицаДанных.Колонки.Добавить(\"Сумма\",        Колонки[2]);\n\n    // --- Запрос для получения данных ---\n    Запрос = Новый Запрос;\n    Запрос.Текст =\n    \"ВЫБРАТЬ\n    |    ПродажиОбороты.Период    КАК Дата,\n    |    ПродажиОбороты.Контрагент КАК Контрагент,\n    |    ПродажиОбороты.СуммаОборот КАК Сумма\n    |ИЗ\n    |    РегистрНакопления.Продажи.Обороты(&ДатаНач, &ДатаКон, День, ) КАК ПродажиОбороты\";\n\n    Запрос.УстановитьПараметр(\"ДатаНач\", ДатаНач);\n    Запрос.УстановитьПараметр(\"ДатаКон\", ДатаКон);\n\n    Выборка = Запрос.Выполнить().Выбрать();\n\n    Пока Выборка.Следующий() Цикл\n        НоваяСтрока = ТаблицаДанных.Добавить();\n        НоваяСтрока.Дата       = Выборка.Дата;\n        НоваяСтрока.Контрагент = Выборка.Контрагент;\n        НоваяСтрока.Сумма      = Выборка.Сумма;\n    КонецЦикла;\n\n    Возврат ТаблицаДанных;\n\nКонецФункции\n\n// ---------------------------------------------------------------------------\n// Схема компоновки данных (добавить в ресурс \"СхемаКомпоновкиДанных\")\n// ---------------------------------------------------------------------------\n// Источник данных:\n//   Тип: ОбъектМодели\n//   Имя объекта данных: ОсновнойНаборДанных\n//\n// Набор данных – таблица:\n//   Поле «Дата»        — Дата\n//   Поле «Контрагент»  — Контрагент\n//   Поле «Сумма»       — Ресурс (Сумма(Сумма))\n//\n// Параметры:\n//   ДатаНач, ДатаКон — Дата\n"
}